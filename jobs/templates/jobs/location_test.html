{% extends "base.html" %}
{% load static %}

{% block title %}Location Test{% endblock %}

{% block content %}
<div class="container">
    <h2>Location Detection Test</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Test Location Detection</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary mb-3" id="testLocation">
                        <i class="fas fa-map-marker-alt"></i> Get My Location
                    </button>
                    
                    <div id="locationResult" class="alert alert-info">
                        Click the button above to test location detection
                    </div>
                    
                    <div class="mt-3">
                        <h6>Manual Test:</h6>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" step="any" class="form-control" id="testLat" 
                                       placeholder="Latitude" value="33.7490">
                            </div>
                            <div class="col-6">
                                <input type="number" step="any" class="form-control" id="testLon" 
                                       placeholder="Longitude" value="-84.3880">
                            </div>
                        </div>
                        <button class="btn btn-secondary mt-2" id="testManual">
                            Test Manual Coordinates
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Browser Information</h5>
                </div>
                <div class="card-body">
                    <div id="browserInfo">
                        <p><strong>Geolocation Support:</strong> <span id="geoSupport">Checking...</span></p>
                        <p><strong>HTTPS:</strong> <span id="httpsStatus">Checking...</span></p>
                        <p><strong>User Agent:</strong> <span id="userAgent">Checking...</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-4">
        <a href="{% url 'jobs:list' %}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Job Search
        </a>
    </div>
</div>

<script>
// Check browser capabilities
document.addEventListener('DOMContentLoaded', function() {
    // Check geolocation support
    const geoSupport = document.getElementById('geoSupport');
    if (navigator.geolocation) {
        geoSupport.innerHTML = '<span class="text-success">✓ Supported</span>';
    } else {
        geoSupport.innerHTML = '<span class="text-danger">✗ Not Supported</span>';
    }
    
    // Check HTTPS
    const httpsStatus = document.getElementById('httpsStatus');
    if (location.protocol === 'https:') {
        httpsStatus.innerHTML = '<span class="text-success">✓ HTTPS</span>';
    } else {
        httpsStatus.innerHTML = '<span class="text-warning">⚠ HTTP (may cause issues)</span>';
    }
    
    // User agent
    document.getElementById('userAgent').textContent = navigator.userAgent;
});

// Test location detection
document.getElementById('testLocation').addEventListener('click', function() {
    const button = this;
    const result = document.getElementById('locationResult');
    
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting location...';
    result.innerHTML = '<div class="alert alert-info">Requesting location access...</div>';
    
    if (!navigator.geolocation) {
        result.innerHTML = '<div class="alert alert-danger">Geolocation is not supported by this browser.</div>';
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-map-marker-alt"></i> Get My Location';
        return;
    }
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            
            result.innerHTML = `
                <div class="alert alert-success">
                    <h6>✓ Location Found!</h6>
                    <p><strong>Latitude:</strong> ${lat.toFixed(6)}</p>
                    <p><strong>Longitude:</strong> ${lon.toFixed(6)}</p>
                    <p><strong>Accuracy:</strong> ${Math.round(accuracy)} meters</p>
                    <p><strong>Timestamp:</strong> ${new Date(position.timestamp).toLocaleString()}</p>
                </div>
            `;
            
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-map-marker-alt"></i> Get My Location';
        },
        function(error) {
            let errorMessage = 'Location detection failed: ';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Permission denied. Please allow location access and try again.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information is unavailable.';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out.';
                    break;
                default:
                    errorMessage += 'Unknown error occurred.';
                    break;
            }
            
            result.innerHTML = `<div class="alert alert-danger">${errorMessage}</div>`;
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-map-marker-alt"></i> Get My Location';
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 300000
        }
    );
});

// Test manual coordinates
document.getElementById('testManual').addEventListener('click', function() {
    const lat = document.getElementById('testLat').value;
    const lon = document.getElementById('testLon').value;
    const result = document.getElementById('locationResult');
    
    if (!lat || !lon) {
        result.innerHTML = '<div class="alert alert-warning">Please enter both latitude and longitude</div>';
        return;
    }
    
    if (isNaN(lat) || isNaN(lon)) {
        result.innerHTML = '<div class="alert alert-warning">Please enter valid numbers</div>';
        return;
    }
    
    result.innerHTML = `
        <div class="alert alert-success">
            <h6>✓ Manual Coordinates</h6>
            <p><strong>Latitude:</strong> ${lat}</p>
            <p><strong>Longitude:</strong> ${lon}</p>
            <p><em>These coordinates can be used for job search</em></p>
        </div>
    `;
});
</script>
{% endblock %}
